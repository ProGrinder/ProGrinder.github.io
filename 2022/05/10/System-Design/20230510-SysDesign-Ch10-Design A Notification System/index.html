<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/default/greycat.ico"><link rel="icon" type="image/png" href="/img/default/greycat.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="Grinder"><meta name="keywords" content=""><title>系统设计-Ch10-设计一个通知系统 - Be Grinder,for Better</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/prism/1.21.0/themes/prism-coy.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1746382_qrhzb41budd.css"><link rel="stylesheet" href="/css/Normalize.css"><link rel="stylesheet" href="/css/GrinderStyle.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><header style="height:72vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Grinder's Space</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/img/default/None.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.07)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-05-10 17:00" pubdate>2022年5月10日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.7k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 41 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">系统设计-Ch10-设计一个通知系统</h1><div class="markdown-body" id="post-body"><h2 id="设计一个通知系统"><a class="markdownIt-Anchor" href="#设计一个通知系统"></a> 设计一个通知系统</h2><p>近年来，通知系统已经成为许多应用中非常流行的功能。通知提醒用户重要信息，如突发新闻，产品更新等。<br>它已成为我们日常生活中不可或缺的一部分。在本章中，您被要求设计一个通知系统。</p><p>通知一共有三种类型，分别是手机推送通知，短信和电子邮件，下图显示了每种通知的示例：</p><p><img src="/img/design/ch10/10-1.png" srcset="/img/loading.gif" alt=""></p><h3 id="step1understand-the-problem-and-establish-design-scope"><a class="markdownIt-Anchor" href="#step1understand-the-problem-and-establish-design-scope"></a> Step1：Understand the problem and establish design scope</h3><p>对于”设计一个通知系统“这个系统设计话题，我们可以向面试官提出以下问题：</p><ul><li><p>Q：系统支持哪些类型的通知？</p><blockquote><p>A：手机推送通知，短信和电子邮件</p></blockquote></li><li><p>Q：这是一个实时系统吗？</p><blockquote><p>A：可以说是一个软实时系统。我们希望用户尽快收到通知，但当系统处于高负载的情况下允许轻微的延迟</p></blockquote></li><li><p>Q：系统支持哪些设备？</p><blockquote><p>A：iOS设备、android设备和笔记本电脑/台式。</p></blockquote></li><li><p>Q：通知由什么触发？</p><blockquote><p>A：通知可以由客户端应用程序触发，也可以在服务器端进行调度。</p></blockquote></li><li><p>Q：用户可以选择关闭通知吗？</p><blockquote><p>A：是的，选择关闭通知的用户将不再收到通知。</p></blockquote></li><li><p>Q：每天发出多少份通知？</p><blockquote><p>A：1000W条手机推送通知、100W条短信、500W封7电子邮件</p></blockquote></li></ul><h3 id="step2propose-high-level-design-and-get-buy-in"><a class="markdownIt-Anchor" href="#step2propose-high-level-design-and-get-buy-in"></a> Step2：Propose high-level design and get buy-in</h3><p>本小节展示了支持各种通知类型的高级设计：</p><ul><li>不同类型的通知(Different types of notification)</li><li>用户联系方手收集流程(Contact info gathering flow)</li><li>通知发送/接收流程(Notification sending/receiving flow)</li></ul><h4 id="different-types-of-notification"><a class="markdownIt-Anchor" href="#different-types-of-notification"></a> Different types of notification</h4><p>首先来看不同类型的通知:</p><p><strong>iOS push notification</strong></p><p>我们主要需要三个组件来发送iOS推送通知：</p><ul><li>Provider：供应商构建通知请求并将其发送到APNS(Apple Push Notification Service)，要构建推送通知，供应商需要提供以下数据：<ul><li><p>Device Token（设备令牌）：用于发送推送给通知的唯一标识符</p></li><li><p>Payload（）：是一个JSON字典，包含推送的有效负载。下面是一个payload示例：</p><pre class="language-json" data-language="json"><code class="language-json">&#123;
    &quot;to&quot;: [
      &#123;
            &quot;user_id&quot;: 123456
        &#125;
    ],
    &quot;from&quot;: &#123;
        &quot;email&quot;: &quot;from_address@example.com&quot;
    &#125;,
    &quot;subject&quot;: &quot;Hello World!&quot;,
    &quot;content&quot;: [
        &#123;
            &quot;type&quot;: &quot;text&#x2F;plain&quot;,
            &quot;value&quot;: &quot;Hello World!&quot;
        &#125;
    ]
&#125;</code></pre><blockquote><p>你可以把payload理解为<strong>一系列信息中最为关键的信息</strong>。</p><p>例如：胶囊里的药粉就是payload，外面的皮是为了保证中间药粉的完好有效。</p></blockquote></li></ul></li><li>APNS：苹果公司提供的一项远程服务，用于向iOS设备发送通知</li><li>iOS：是接收推送通知的客户端</li></ul><p><strong>Android push notification</strong></p><p>安卓采用了与iOS类似的通知推送流程。只不过中间的是FCM(Firebase Cloud Messaging) 而不是APNS。</p><p><strong>SMS message</strong></p><p>对于SMS（短信服务）,通常使用第三方SMS服务，如Twilio、Nexmo,都是商业（付费）服务。</p><p><strong>Email</strong></p><p>对于电子邮件，公司可以自建电子邮件服务器，但是也有许多公司选择了商业（付费）电子服务，如Sendgrid和Mailchimp，它们提供了更好的推送效率和数据分析。</p><h4 id="contact-info-gathering-flow"><a class="markdownIt-Anchor" href="#contact-info-gathering-flow"></a> Contact info gathering flow</h4><p>要发送通知，我们需要收集移动设备令牌，电话号码或邮箱地址，如下图所示：</p><p><img src="/img/design/ch10/10-7.png" srcset="/img/loading.gif" alt=""></p><p>当用户首次安装注册我们的应用时，API服务器会收集用户联系方式并将其存储到数据库中。</p><hr><p>下图显示了用于存储联系人信息的简化数据库表：</p><p><img src="/img/design/ch10/10-8.png" srcset="/img/loading.gif" alt=""></p><p>邮箱(email)和电话号码(phone_number)存储在用户表，移动设备令牌存储在设备表（通过user_id关联），这表明一个用户可能有多个设备，因此可以向多个设备发通知。</p><h4 id="notification-sendingreceiving-flow"><a class="markdownIt-Anchor" href="#notification-sendingreceiving-flow"></a> Notification sending/receiving flow</h4><p>我们首先介绍一下通知推送的初始high-level设计，然后推荐一些优化方式。</p><p><strong>Hig-level Design</strong></p><p>下图展示了通知推送系统的high-level design，你会看到一些必要的系统组件：</p><p><img src="/img/design/ch10/10-9.png" srcset="/img/loading.gif" alt=""></p><ul><li><strong>Service 1 to N</strong>：服务可以是微服务，cron job，或是一个用于触发通知推送事件的分布式系统。例如，计费服务发送电子邮件以提醒客户应该付款，或者购物网站告诉客户他们的包裹将在明天到达快递点等等。</li><li><strong>Notification System</strong>：通知系统(Notification System)是发送/接收通知的核心。从简单的事情开始，只是用一个通知服务器。它为Service 1 to N提供API，并且为第三方服务构建Notification payload。</li><li><strong>Tird-party Services</strong>：第三方服务负责向用户发送通知。在与第三方服务集成时，需要格外注意可扩展性，当前使用的第三方服务可能在未来不可用或被其它第三方服务替代，良好的可扩展性意味着可插拔的第三方服务。</li><li><strong>iOS，Amdroid，SMS，Email</strong>：用户在他们自己的设备上收到通知推送。</li></ul><p>这个设计中存在三个问题：</p><ol><li>Single point of failue(SPOF，单点故障)：单个通知服务器意味着单点故障</li><li>Hard to scale（难以扩展）：通知系统在一台服务器中处理与推送通知相关的一切。独立扩展数据库、缓存和不同的通知处理组件具有挑战性。</li><li>Performance bottleneck(性能瓶颈)：处理和发送通知可能会占用大量资源。例如，构建HTML页面和等待第三方服务的响应可能会占用大量时间。</li></ol><blockquote><p>（本质上都是单点服务器的问题，喊着你上分布式呢！）</p></blockquote><p><strong>Hig-level Design(improved)</strong></p><p>我们对设计进行了改进，如下图所示：</p><p><img src="/img/design/ch10/10-10.png" srcset="/img/loading.gif" alt=""></p><ul><li>将数据库(DB)和缓存(Cache)移出服务器：</li><li>添加更多通知服务器，并设置自动横向扩展:</li><li>引入消息队列解耦系统组件：我们给每种通知类型都分配了消息队列，当要发送大量通知时，消息队列充当缓冲区，因此第三方服务的中断不会影响其它通知类型。</li><li>引入Worker：worker是从消息队列中提取通知事件并将其发送到相应第三方服务的服务器。</li></ul><p>经过improved后，现在的通知推送流程如下：</p><ol><li>Service调用Notification Server提供的API来发送通知</li><li>Notification Server从缓存(Cache)或数据库(DB)中获取元数据，如用户信息，设备令牌和通知设置。</li><li>将通知事件(notification events)发送到相应的消息队列等待处理</li><li>Worker从消息队列中提取通知事件</li><li>Worker向第三方服务发送通知</li><li>第三方服务向用户设备发送通知</li></ol><h3 id="step3design-deep-dive"><a class="markdownIt-Anchor" href="#step3design-deep-dive"></a> Step3：Design deep dive</h3><p>我们将在Design deep dive中讨论如下内容：</p><ul><li>Reliability：</li><li>Additional compent and considerations</li><li>Updated design</li></ul><h4 id="reliability"><a class="markdownIt-Anchor" href="#reliability"></a> Reliability</h4><p>在分布式环境中设计系统时，我们必须回答几个重要的可靠性问题。</p><p><strong>How to prevent data loss?</strong></p><p>通知系统最重要的要求之一就是不能丢失数据。通知可以延迟或者重新发送，但是不能永远不会丢失。为了满足这一要求：通知数据保存在数据库中，并实现重试机制（通知日志数据库用于数据持久化）。</p><p><img src="/img/design/ch10/10-11.png" srcset="/img/loading.gif" alt=""></p><p><strong>Will recipients receive a notification exactly once？</strong></p><p>收件人会只收到一次通知吗？答案当然是No。尽管大多数情况下通知只发送一次，但分布式性质可能会导致重复的通知。为了减少重复的发生，我们引入了重复数据消除机制，以下是一个简单的数据消除机制的实现逻辑：</p><p>当通知事件第一次到达时，我们通过检查事件ID来检查它以前是否被查看过，如果它以前被查看过，它将被丢弃；否则，我们将发送通知。</p><h4 id="additional-compnents-and-considerations"><a class="markdownIt-Anchor" href="#additional-compnents-and-considerations"></a> Additional compnents and considerations</h4><p>这里我们讨论通知系统的其它组件，包括模板重用，通知设置、事件跟踪、系统监控和速率限制等。</p><p><strong>Notification template</strong></p><p>一个大型通知系统每天发送数百万个通知，其中许多通知采用类似的格式。引入通知模板可以快速构建一个通知，以避免从头开始构建每个通知。</p><p><strong>Notification setting</strong></p><p>用户通常每天都会收到很多通知，他们很容易因此感到不知所措。</p><p>为此，许多网站和应用都为用户提供了对通知设置的细粒度控制，比如设计一个通知设置表，包含以下字段：</p><pre class="language-sql" data-language="sql"><code class="language-sql">user_id bigInt  # 用户id
channel varchar # 频道类型：SMS或邮件或手机推送
opt_in boolean  # 用户是否接收此类通知</code></pre><p>在向用户发送任何通知之前，首先检查用户是否已选择接收此类通知。</p><p><strong>Rating limiting</strong></p><p>速率限制：为了避免用户收到过多通知，我们可以限制用户在一定时间内可以接收通知的数量。这一点很重要，因为如果我们发送得太频繁，用户很可能会完全关闭通知权限。</p><p><strong>Security in push notifications</strong></p><p>对于iOS或Andriod应用程序，appKey和appSecret用户保护推送通知API。只有经过身份验证的客户端才允许使用我们的API发送推送通知。</p><p><strong>Monitor queued notifications</strong></p><p>系统需要监控的关键指标之一是消息队列中的通知总数，如果这个数量很大，则说明Worker处理通知事件的速度不够快，需要部署更多的Worker以避免消息延迟。</p><p><strong>Events tracking</strong></p><p>通知系统中的一些指标，如打开率，点击率和参与度等，对于理解用户行为非常重要。分析服务需要事件跟踪(Events tracking)来实现，下图显示了出于分析目的可能被跟踪的事件示例：</p><p><img src="/img/design/ch10/10-13.png" srcset="/img/loading.gif" alt=""></p><h4 id="update-design"><a class="markdownIt-Anchor" href="#update-design"></a> Update design</h4><p>把design deep dive中提到的组件加上，更新后的通知系统设计图如下所示：</p><p><img src="/img/design/ch10/10-14.png" srcset="/img/loading.gif" alt=""></p><ul><li>通知服务器添加了两个关键功能：身份验证(authentication)和速率限制(Rate-Limiting)</li><li>我们还添加了一个重试机制来处理通知失败。如果系统未能发送通知，它们将被放回消息队列中，Worker将重置预定义的次数。</li><li>此外，通知模板提供了一致且高效的通知创建过程</li><li>最后，增加了监测和跟踪系统，用户系统健康检查和未来改进</li></ul><h3 id="step4warm-up"><a class="markdownIt-Anchor" href="#step4warm-up"></a> Step4：Warm up</h3><p>一点文字总结，没什么看的。</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/System-Design/">System Design</a></div></div><p class="note note-warning">本博客所有文章均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-NC-SA 4.0 协议</a> ，禁止商用，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/2022/05/10/20230512-SysDesign-Ch12-Design%20A%20Notification%20System/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">系统设计-Ch10-设计一个通知系统</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/05/09/System-Design/20230509-SysDesign-Ch9-Design%20A%20Web%20Crawler/"><span class="hidden-mobile">系统设计-Ch9-设计一个网络爬虫</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">function loadValine(){addScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"zFsXUmmjrQgI8Mwc4q1hoeFX-gzGzoHsz",app_key:"lhfQutIrdSGngahzOrpkaKBU",placeholder:"说点什么吧！~(支持Markdown语法)",path:window.location.pathname,avatar:"retro",meta:["nick","mail","link"],pageSize:"10",lang:"zh-CN",highlight:!0,recordIP:!1,serverURLs:""})}))}waitElementVisible("vcomments",loadValine)</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div id="aplayer"></div><script defer src="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css"><script type="text/javascript">var oldLoadAp=window.onload;window.onload=function(){oldLoadAp&&oldLoadAp(),new APlayer({container:document.getElementById("aplayer"),fixed:!0,autoplay:!1,loop:"all",order:"list",theme:"#b7daff",preload:"auto",lrcType:3,audio:[{name:"Reforget",artist:"Lauv",url:"/songs/Reforget.wav",cover:"/img/songs/Cover_Reforget.jpg",lrc:"/songs/lrc/Reforget.lrc"},{name:"Saint",artist:"Travis Scott & Quavo",url:"/songs/Saint.wav",cover:"/img/songs/Cover_Saint.jpg",lrc:"/songs/lrc/Saint.lrc"},{name:"Antisocial",artist:"Travis Scott & Ed Sheeran",url:"/songs/Antisocial.wav",cover:"/img/songs/Cover_Antisocial.jpg",lrc:"/songs/lrc/Antisocial.lrc"},{name:"Champion",artist:"Travis Scott & Nav",url:"/songs/Champion.wav",cover:"/img/songs/Cover_Champion.jpg",lrc:"/songs/lrc/Champion.lrc"},{name:"Smile",artist:"The Weekend & Juice WRLD",url:"/songs/Smile.wav",cover:"/img/songs/Cover_Smile.jpg",lrc:"/songs/lrc/Smile.lrc"},{name:"Starboy",artist:"The Weekend",url:"/songs/Starboy.wav",cover:"/img/songs/Cover_Starboy.jpg",lrc:"/songs/lrc/Starboy.lrc"},{name:"Sidewalks",artist:"The Weekend",url:"/songs/Sidewalks.wav",cover:"/img/songs/Cover_Sidewalks.jpg",lrc:"/songs/lrc/Sidewalks.lrc"},{name:"Reminder",artist:"The Weekend",url:"/songs/Reminder.wav",cover:"/img/songs/Cover_Reminder.jpg",lrc:"/songs/lrc/Reminder.lrc"},{name:"Die For You",artist:"The Weekend",url:"/songs/Die For You.wav",cover:"/img/songs/Cover_Die For You.jpg",lrc:"/songs/lrc/Die For You.lrc"},{name:"Pray For Me",artist:"The Weekend & Kendrick Lamar",url:"/songs/Pray For Me.wav",cover:"/img/songs/Cover_Pray For Me.jpg",lrc:"/songs/lrc/Pray For Me.lrc"}]})}</script><footer class="mt-5"><div class="text-center py-3"><div><br>Powered by: <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> Theme: <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div><div class="beian"><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">赣ICP备2021001689号</a></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/prism/1.21.0/components/prism-core.min.js"></script><script src="https://cdn.staticfile.org/prism/1.21.0/plugins/autoloader/prism-autoloader.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready((function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:0,scrollSmooth:!0,headingsOffset:-t}),$(".toc-list-item").length>0&&$("#toc").css("visibility","visible")}))</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","系统设计-Ch10-设计一个通知系统&nbsp;"],cursorChar:"_",typeSpeed:72,loop:!1});typed.stop(),$(document).ready((function(){$(".typed-cursor").addClass("h2"),typed.start()}))</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options={placement:"right",visible:"hover"};var el="h1,h2,h3,h4,h5,h6".split(","),res=[];for(item of el)res.push(".markdown-body > "+item);anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)}))</script><link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css"><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f9aad97d2fdeed725d5d52997eaebaa9";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>